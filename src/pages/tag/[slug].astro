---
import DefaultPageLayout from "$/layouts/default.astro";
import PostPreview from "$components/PostPreview.astro";
import { getAllPosts, getAllTags, getSettings } from "$/utils/api";
import { getGhostImgPath } from "$/utils";

export async function getStaticPaths({}) {
  const { posts } = await getAllPosts({ include: "authors,tags" });
  const { tags } = await getAllTags({ include: "count.posts" });
  const { settings } = await getSettings();

  return tags.map((tag) => {
    const filteredPosts = posts.filter((post) =>
      post.tags.map((tag) => tag.slug).includes(tag.slug)
    );
    return {
      params: { slug: tag.slug },
      props: {
        posts: filteredPosts,
        settings,
        tag,
      },
    };
  });
}

const { posts, settings, tag } = Astro.props;
const { params } = Astro.params;
---

<DefaultPageLayout
  bodyClass={`tag-template tag-${tag.slug}`}
  settings={settings}
/>
